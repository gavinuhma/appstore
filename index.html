<!DOCTYPE html>
<html>
<head>
<meta charset='utf-8'>
<title>gavinuhma/appstore @ GitHub</title>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js"></script>
<script type="text/javascript">
var createBucket = function(bucket) {
  console.log('creating bucket ' + bucket);
  $.ajax({
    type: "PUT",
    url: 'http://api.thriftdb.com/' + bucket,
    data: '',
    success: function(res) {
      console.log('bucket created ' + bucket + ': ' + res);
    }
  });
};
var createCollection = function(bucket, collection, data) {
  console.log('creating collection ' + collection + ' in bucket ' + bucket + ', data: ' + data);
  var schema = createCollectionSchema(data);
  $.ajax({
    type: "PUT",
    url: 'http://api.thriftdb.com/' + bucket + '/' + collection,
    data: schema,
    success: function(res) {
      console.log('created collection ' + collection + ' in bucket ' + bucket + ', data: ' + data + ': ' + res);
    }
  });
};
var createCollectionSchema = function(collection) {
  var schema = {'__class__': 'StructSchema'};
  var i = 0;
  for (var field in collection) {
    i++;
    schema[field] = {'__class__': 'AttributeDescriptor'};
    schema[field]['thrift_index'] = i;
    schema[field]['datatype'] = {'__class__': collection[field]['datatype']};
    schema[field]['is_searchable'] = true;
  }
  console.log(schema);
  return JSON.stringify(schema);
};
var collection = {
  'name': {'datatype':'StringType'},
  'url': {'datatype':'StringType'}
};
$('#createBucket').click(function(e) {
  createBucket('appstore');
  e.preventDefault();
  return false;
});
$('#createCollection').click(function(e) {
  createCollection('appstore', 'apps', collection);
  e.preventDefault();
  return false;
});
/*curl -X PUT "http://api.thriftdb.com/test_bucket"
$.getJSON("http://api.flickr.com/services/feeds/photos_public.gne?jsoncallback=?", {
  tags: "cat",
  tagmode: "any",
  format: "json"
}, function(data) {
  $.each(data.items, function(i,item) {
    $("<img/>").attr("src", item.media.m).appendTo("#images");
    if ( i == 3 ) return false;
  });
});*/
</script>
<style type="text/css">
</style>
</head>
<body>
<a href="#createBucket" id="createBucket">createBucket</a>
<a href="#createCollection" id="createCollection">createCollection</a>
<div id="images"></div>
<a href="http://github.com/gavinuhma/appstore">
<img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub" />
</a> 
</body>
</html>
